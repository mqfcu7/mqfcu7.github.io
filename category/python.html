<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <title>mqfcu7's blog - Python</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="mqfcu7's blog Atom Feed" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">mqfcu7's blog </a></h1>
                <nav><ul>
                    <li class="active"><a href="/category/python.html">Python</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/python_opencvwen-jian-she-xiang-tou-he-gui.html">[Python_OpenCV]文件、摄像头和GUI</a></h1>
<footer class="post-info">
        <abbr class="published" title="2015-02-05T00:00:00+08:00">
                Published: 周四 05 二月 2015
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/mqfcu7.html">mqfcu7</a>
        </address>
<p>In <a href="/category/python.html">Python</a>. </p>
<p>tags: <a href="/tag/opencv.html">OpenCV</a> </p>
</footer><!-- /.post-info --><blockquote>
<ol>
<li>Joseph Howse, OpenCV Computer Vision with Python, April 2013.</li>
<li><a href="http://wiki.opencv.org.cn/images/4/41/Opencv-ref-man-2.3.1.pdf">Opencv-ref-man-2.3.1</a></li>
</ol>
</blockquote>
<p>python在调用OpenCV时，需要：</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">cv2</span>
</pre></div>


<h4>1 图像、视频、摄像头</h4>
<h5>1.1 图像读写</h5>
<p>打开一个图像文件，并保存成其他图像格式：</p>
<div class="highlight"><pre><span class="n">imgSrc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s">r&#39;pic.jpg&#39;</span><span class="p">)</span>   <span class="c"># 常见的图片格式都能读取，具体可参见[2]</span>
<span class="k">assert</span> <span class="n">imgSrc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>         <span class="c"># 图像文件读取是否成功</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s">r&#39;save.png&#39;</span><span class="p">,</span> <span class="n">imgSrc</span><span class="p">)</span>  <span class="c"># OpenCV能解析文件的扩展名，保存成相应的压缩格式</span>
</pre></div>


<p><code>cv2.imread()</code>有第二个参数，能控制读成RGB彩色图、灰色图或跟文件颜色形式一致，缺省为RGB。
<code>cv2.imwrite()</code>有第三个参数，能控制图像保存时的图像压缩质量。这里的图像压缩是全局压缩，但有时为了考虑文件大小与图像质量，会有图像局部压缩的需要。比如智能交通中车辆卡口图像，仅需要保真车牌部分，而OpenCV没有提供局部压缩的功能。</p>
<h5>1.2 视频文件读写</h5>
<p>打开一个视频文件，并保存成其他视频格式：</p>
<div class="highlight"><pre><span class="n">capture</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="s">&#39;video.avi&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">capture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
<span class="n">fps</span>     <span class="o">=</span> <span class="n">capture</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">CV_CAP_PROP_FPS</span><span class="p">)</span>                  <span class="c"># 获取原视频帧率</span>
<span class="n">size</span>    <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">capture</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">CV_CAP_PROP_FRAME_WIDTH</span><span class="p">)),</span>
           <span class="nb">int</span><span class="p">(</span><span class="n">capture</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">CV_CAP_PROP_FRAME_HEIGHT</span><span class="p">)))</span>  <span class="c"># 获取分辨率</span>
<span class="n">writer</span>  <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span><span class="s">&#39;out.avi&#39;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">CV_FOURCC</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">,</span><span class="s">&#39;4&#39;</span><span class="p">,</span><span class="s">&#39;2&#39;</span><span class="p">,</span><span class="s">&#39;0&#39;</span><span class="p">),</span> <span class="n">fps</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">capture</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">while</span> <span class="n">frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">captrue</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>


<p><code>cv2.VideoCapture()</code>支持读取*.avi、*.mp4文件，但常常会遇到这样的文件读取不了，这可能是机器上没有相应的解码器，可以安装<a href="http://download.pchome.net/multimedia/mpeg4/player/detail-15603.html">DivX Plus</a>和<a href="http://dl.pconline.com.cn/html_2/1/124/id=6563&amp;pn=0.html">K-Lite Codec Pack</a>。
<code>cv2.VideoWriter()</code>第二个参数控制视频编码的格式，输入-1，则会交互地弹出一个对话框让你从系统已有的编码中选择一个。</p>
<h5>1.3 打开摄像头</h5>
<div class="highlight"><pre><span class="n">capture</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>


<p><code>cv2.VideoCapture()</code>当该函数的第一个参数为数字时表示摄像头摄像头id，当只有一个摄像头时，传入0，OpenCV会打开该摄像头。该功能仅限笔记本、USB摄像头，对于工业的网络摄像头（如海康摄像头、AXIS摄像头等）需要针对SDK进行相应开发。</p>
<h4>2 GUI</h4>
<h5>2.1 显示图像</h5>
<p>打开一个窗体，用于显示摄像头捕获的图像：</p>
<div class="highlight"><pre><span class="n">cv2</span><span class="o">.</span><span class="n">namedWindow</span><span class="p">(</span><span class="s">&#39;Image&#39;</span><span class="p">)</span>        <span class="c"># 创建一个名叫“Image”的窗体</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s">&#39;Video&#39;</span><span class="p">,</span> <span class="n">imgSrc</span><span class="p">)</span>     <span class="c"># 显示imgSrc图像到“Image”窗口中</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>                  <span class="c"># 窗体hold住</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyWindow</span><span class="p">(</span><span class="s">&#39;Video&#39;</span><span class="p">)</span>
</pre></div>


<p><code>cv.waitKey()</code>该函数等待用户键盘事件，参数为等待时长，单位是ms。<strong>注意，窗体显示必须调用一下该函数，否则窗口中无画面</strong>，当参数为0时，窗口将无限等待，该函数是有返回值，没接受到键盘事件时的返回值为-1。</p>
<h4>3 完整例子</h4>
<p>显示摄像头采样的图像，按键盘中的"s"将保存当前画面，"q"将退出程序：</p>
<div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>

<span class="c">## </span>
<span class="c"># @brief 显示摄像头采样的图像，并接受键盘事件</span>
<span class="c"># @author ShuaiLu</span>
<span class="c"># @date 2014-06-09</span>

<span class="kn">import</span> <span class="nn">cv2</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">namedWindow</span><span class="p">(</span><span class="s">&#39;Video&#39;</span><span class="p">)</span>

<span class="n">capture</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="s">r&#39;特种车识别.avi&#39;</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">capture</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">while</span> <span class="n">frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s">&#39;Video&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

    <span class="n">key</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">):</span>     <span class="c"># 当按下&quot;s&quot;键时，将保存当前画面</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s">&#39;screenshot.bmp&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;q&#39;</span><span class="p">):</span>   <span class="c"># 当按下&quot;q&quot;键时，将退出循环</span>
        <span class="k">break</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">capture</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">destroyWindow</span><span class="p">(</span><span class="s">&#39;Video&#39;</span><span class="p">)</span>
</pre></div>                </article>
<p class="paginator">
    Page 1 / 1
</p>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>